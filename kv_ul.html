<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>根据百分比展示图片列表，点击图片更换kv图</title>
    <style>
        .ul_div {
            width: 1200px;
            margin: 0px auto;
            position: relative;
            overflow: hidden;
        }

        .ul_left, .ul_right {
            width: 10%;
            float: left;
            height: 100%;
            position: relative;
        }

        .ul_left img, .ul_right img {
            position: absolute;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
            margin: auto;
        }

        .ul_content {
            float: left;
            width: 1200px;
            overflow: hidden;
        }

        .ul_content ul {
            width: 2200px;
            list-style: none;
            list-style-type: none;
        }

        .ul_content li {
            width: 200px;
            float: left;
            cursor: pointer;
            position: relative;
        }

        .pointer {
            cursor: pointer;
        }

        .w_80 {
            width: 90%;
            margin: 0 auto;
            position: relative;
        }


    </style>

    <script type="text/javascript" src="js/jquery-1.11.0.min.js"></script>


</head>
<body>

<style>
    .timeLine {
        height: 20px;
        line-height: 20px;
    }
</style>
<div style="width: 90%;height:450px;margin:20px auto;position: relative;overflow: hidden">
    <div class="ul_left pointer" style="height: 100%"><img id="leftArrow" style="bottom: 0px;display: none"
                                                           onclick="nextLi(-1)" src="images/left.jpg"></div>
    <div style="float:left;text-align: center; overflow:hidden;width: 80%"><img style="width: 100%" id="bigImg"
                                                                                src="images/b0.jpg"></div>
    <div class="ul_right pointer" style="height: 100%"><img id="rightArrow" style="bottom: 0px" onclick="nextLi(+1)"
                                                            src="images/right.jpg"></div>
</div>

<div class="w_80 timeLine">
    <div class="timeLine" style="width: 10%;float: left;position: relative">
        <span id="index_span" style="position: absolute;right: 20px;" class="timeLine">1/11</span>
    </div>
    <div class="timeLine" style="float: left;width: 89%;position: relative">
        <div id="line" style="width: 100%;height:20px;background-color: #18c6eb"></div>
        <div id="silder"
             style="width: 30px;height:20px;background-color: #000000;position: absolute;left: 0;top: 0"></div>
    </div>
</div>

<div class="ul_div">
    <div class="ul_content" id="ul_content">
        <ul id="show_ul">
            <li><img src="images/s0.jpg"><span
                    style="position: absolute;left: 20px;top: 20px;z-index: 99;font-size:30px;color: #ff0000">0</span>
                <div class="scale_div" style="border:3px solid #18c6eb;display:none;position: absolute;z-index: 99;width: 100%;height: 100%"><img style="width: 100%" src="images/s0.jpg"></div>
            </li>
            <li><img src="images/s1.jpg"><span
                    style="position: absolute;left: 20px;top: 20px;z-index: 99;font-size:30px;color: #ff0000">1</span>
            </li>
            <li><img src="images/s2.jpg"><span
                    style="position: absolute;left: 20px;top: 20px;z-index: 99;font-size:30px;color: #ff0000">2</span>
            </li>
            <li><img src="images/s3.jpg"><span
                    style="position: absolute;left: 20px;top: 20px;z-index: 99;font-size:30px;color: #ff0000">3</span>
            </li>
            <li><img src="images/s4.jpg"><span
                    style="position: absolute;left: 20px;top: 20px;z-index: 99;font-size:30px;color: #ff0000">4</span>
            </li>
            <li><img src="images/s5.jpg"><span
                    style="position: absolute;left: 20px;top: 20px;z-index: 99;font-size:30px;color: #ff0000">5</span>
            </li>
            <li><img src="images/s6.jpg"><span
                    style="position: absolute;left: 20px;top: 20px;z-index: 99;font-size:30px;color: #ff0000">6</span>
            </li>
            <li><img src="images/s7.jpg"><span
                    style="position: absolute;left: 20px;top: 20px;z-index: 99;font-size:30px;color: #ff0000">7</span>
            </li>
            <li><img src="images/s8.jpg"><span
                    style="position: absolute;left: 20px;top: 20px;z-index: 99;font-size:30px;color: #ff0000">8</span>
            </li>
            <li><img src="images/s9.jpg"><span
                    style="position: absolute;left: 20px;top: 20px;z-index: 99;font-size:30px;color: #ff0000">9</span>
            </li>
            <li><img src="images/s10.jpg"><span
                    style="position: absolute;left: 20px;top: 20px;z-index: 99;font-size:30px;color: #ff0000">10</span>
            </li>
        </ul>
    </div>
</div>

</body>
<script>

var show_li_num = 6;// li 显示的个数 ul_content_width/li_width;

var showIndex = 2;// 设置显示第几个 li 显示

var middle;

var ul_content_width;// ul 需要显示的宽度

var li_num;// li 的数量减1

var li_width;// li 的宽度

var ul_width;// ul 的总宽度 li*li_num;

var line_width;

var silder_width;

var start_x = 0;

var move_x = 0;

var offset_x = 0;

var percent_x = 0;

var ul_margin_left = 0;

var silder_left = 0;

var is_start = false;

var is_animate = false;

function initUl() {

    ul_content_width = $("#ul_content").width();

    li_num = $("#show_ul li").length - 1;

    li_width = $("#show_ul li:nth-child(1)").width();

    ul_width = li_width * (li_num + 1);

    $("#show_ul").width(ul_width);

    middle = Math.floor((ul_content_width / li_width) / 2);

    center_index = middle - 1;

}

initUl();

function initSilderParams() {

    silder_left = $("#silder").position().left;

    silder_width = $("#silder").width();

    line_width = $("#line").width();

    ul_margin_left = parseInt($("#show_ul").css("marginLeft"));
}

initSilderParams();

function initSilder() {

    $("#silder").mousedown(function (e) {

        silder_left = $("#silder").position().left;

        silder_width = $("#silder").width();

        line_width = $("#line").width();

        ul_margin_left = parseInt($("#show_ul").css("marginLeft"));

        console.log("s_width::", line_width, "silder_left::", silder_left);

        start_x = e.pageX;

        console.log("start_x:::", start_x)

        is_start = true;

    });

    $(document).mouseup(function () {

        is_start = false;

    })

    $(document).mousemove(function (e) {

        if (!is_start)return;

        move_x = e.pageX;

        offset_x = move_x - start_x;

        var new_silder_left = silder_left + offset_x;

        if (new_silder_left < 0) {

            new_silder_left = 0;

        } else if (new_silder_left > line_width - silder_width) {

            new_silder_left = line_width - silder_width;

        }

        $("#silder").css("left", new_silder_left);

        percent_x = offset_x / (line_width - silder_width) * (ul_width - ul_content_width);

        var new_ul_margin_left = ul_margin_left - percent_x;

        if (new_ul_margin_left <= ul_content_width - ul_width) {

            new_ul_margin_left = ul_content_width - ul_width;

        } else if (new_ul_margin_left >= 0) {

            new_ul_margin_left = 0;

        }

        $("#show_ul").css("marginLeft", new_ul_margin_left);

    })

}

initSilder();

function initLiClick() {

    $("#show_ul li").on("click", function () {

        if (is_animate)return;

        var index = $(this).index();

        move(index);

    })
}

initLiClick();

var center_index;

function move(index) {

    is_animate = true;

    initSilderParams();

    console.log("index:::", index)

    $("#bigImg").attr("src", "images/b" + index + ".jpg");

    var left_x;

    if (index < middle) {

        showIndex = index;

        center_index = middle;

        $("#show_ul").animate({marginLeft: 0}, function () {

            is_animate = false;

        });

        left_x = 0;

        zoom(index);

    } else if (index > li_num - middle) {

        showIndex = index;

        center_index = li_num - middle;

        new_ul_margin_left = ul_content_width - ul_width;

        $("#show_ul").animate({marginLeft: new_ul_margin_left}, function () {

            is_animate = false;

        });

        left_x = line_width - silder_width;

    } else {

//        var offset_index = showIndex - index;

        var offset_index = center_index - index;

        var offset_left = offset_index * li_width;

        var new_ul_margin_left = ul_margin_left + offset_left;

        if (new_ul_margin_left <= ul_content_width - ul_width) {

            new_ul_margin_left = ul_content_width - ul_width;

        } else if (new_ul_margin_left >= 0) {

            new_ul_margin_left = 0;

        }

        $("#show_ul").animate({marginLeft: new_ul_margin_left}, function () {

            is_animate = false;

        });

        ul_margin_left = new_ul_margin_left;

        showIndex = index;

        center_index = index;

        var percent_index = index - middle;

//        var left_x = index / (li_num - show_li_num + 1) * (line_width - silder_width);

        left_x = percent_index / (li_num - show_li_num) * (line_width - silder_width);


        console.log("index:::", index, "left_x:::", left_x)

        if (left_x <= 0) {

            left_x = 0;

        } else if (left_x >= line_width - silder_width) {

            left_x = line_width - silder_width;
        }

        console.log("percent_index:::", percent_index, "left_x:::", left_x);


    }

    //因为有些版本的 jquery 有 bug 设置相同 left 值时会变成0；
    //在某些ie版本上，juqery的animate方法设置数值会有误差。比如设置 animate({"left":870}) 最后结果可能是869.99992，并不是870
    if (silder_left == left_x) {

        var silder = document.getElementById("silder");

        silder.style.left = left_x + "px";

    } else {

        $("#silder").animate({"left": left_x});

    }

    var index_txt = showIndex + 1;

    var total_txt = li_num + 1;

    $("#index_span").text(index_txt + "/" + total_txt);

    $("#leftArrow").show();

    $("#rightArrow").show();

    if (showIndex == 0) {

        $("#leftArrow").hide();

    } else if (showIndex == li_num) {

        $("#rightArrow").hide();

    }
}

function nextLi(index) {

    if (is_animate)return;

    var newIndex = showIndex + index;

    console.log("newIndex", newIndex)

    if (newIndex < 0) {

        newIndex = 0;


    } else if (newIndex > li_num) {

        newIndex = li_num;

    }

    move(newIndex);

}

function initShowIndex() {

    move(showIndex);
}

initShowIndex();

function zoom(index){

    var selected_index=index+1;

    var div="#show_ul li:nth-child("+selected_index+") div";

    var img="#show_ul li:nth-child("+selected_index+") img";

    var w=$(img).width();

    var h=$(img).height();

    $(div).width(w);

    $(div).height(h)

    $(div).show();

    $(div).animate({left:-10,top:-10,width:w+20,height:h+20});

}

</script>
</html>

