<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>简单弹幕效果</title>
    <script type="text/javascript" src="js/jquery-1.11.0.min.js"></script>
    <style>
        html, body {
            width: 100%;
            margin: 0;
            padding: 0;
        }

        #pop_kv {
            width: 90%;
            margin: 30px auto;
            background-color: #e7fcff;
            height: 400px;
            position: relative;

            overflow: hidden;

        }
    </style>
</head>
<body>
<div id="pop_kv">

</div>
<script>
    var pop_kv = $("#pop_kv")[0];

    var pop_width = $("#pop_kv").width();

    var min_y = 50;

    var max_y = 350;

    var move_pops = [];

    var create_delay = 1000;

    var prev_time = 0;

    var pops = ["0.png", "1.png", "2.png", "3.png", "4.png", "5.png", "6.png", "7.png", "8.png", "9.png", "10.png", "11.png", "12.png", "13.png", "14.png"]

    var slogan = "slogan.png";

    var last_top = 0;

    //随机打乱数组顺序
    function randomIndex() {

        var lg = pops.length;

        for (var i = 0; i < lg; i++) {

            var index = Math.floor(Math.random() * lg);

            var i_value = pops[i];

            pops[i] = pops[index];

            pops[index] = i_value;

        }

        console.log(pops);
    }

    randomIndex();

    var id_num = 0;

    function createPop(index) {

        var left = pop_width;

        var top = min_y + Math.random() * 250;

        while (Math.abs(top - last_top) < 50) {

            top = min_y + Math.random() * 250;

        }

        last_top = top;

        var img = document.createElement("img");

        id_num++;

        var src = "pop_img/" + pops[index];

        img.id = "img" + id_num;

        $(img).attr("src", src);

        $(img).css({"left": left, "top": top, "position": "absolute"});

        var speed = 3 + Math.random() * 3;

        var pop = {"img": img, "speed": speed};

        move_pops.push(pop);

        $("#pop_kv").append(img);

    }

    var current_index = 0;

    function loop() {

        var current_time = new Date().getTime();

        if (current_time - prev_time > create_delay) {

            if (current_index > 14) {

                current_index = 0;

            }

            createPop(current_index);

            current_index++;

            prev_time = current_time;
        }


        movePops();

        setTimeout(loop, 33);
    }

    loop();

    function movePops() {

        for (var i = 0; i < move_pops.length; i++) {

            var left = $(move_pops[i].img).position().left;

            left -= move_pops[i].speed;

            if (left < -500) {

                var pop = move_pops.splice(i, 1);

                pop_kv.removeChild(pop[0].img);

            } else {

                $(move_pops[i].img).css("left", left);

            }

        }
    }
</script>
</body>
</html>